var e,t;function n(e){return e.filter(e=>null!=e)}!function(e){e[e.TEXT=Node.TEXT_NODE]="TEXT",e[e.ELEMENT=Node.ELEMENT_NODE]="ELEMENT",e[e.FRAGMENT=Node.DOCUMENT_FRAGMENT_NODE]="FRAGMENT",e.FIBER="FIBER"}(e||(e={})),function(e){e.ADD="add",e.REMOVE="remove",e.MOVE="move",e.NOOP="noop"}(t||(t={}));class r{#e=[];#t=[];#n;constructor(e,t){this.#e=[...e],this.#t=e.map((e,t)=>t),this.#n=t}get length(){return this.#e.length}originalIndexAt(e){return this.#t[e]}findIndexFrom(e,t){for(let n=t;n<this.length;n++)if(this.#n(e,this.#e[n]))return n;return-1}wasElementRemoved(e,t){if(e>=this.length)return!1;const n=this.#e[e];return-1===t.findIndex(e=>this.#n(n,e))}wasElementTheSame(e,t){if(e>=this.length)return!1;const n=this.#e[e],r=t[e];return this.#n(n,r)}wasElementAdded(e,t){return-1===this.findIndexFrom(e,t)}removeItemAction(e){const n={op:t.REMOVE,index:e,item:this.#e[e]};return this.#e.splice(e,1),this.#t.splice(e,1),n}noopItemAction(e){return{op:t.NOOP,originalIndex:this.originalIndexAt(e),index:e,item:this.#e[e]}}addItemAction(e,n){const r={op:t.ADD,index:n,item:e};return this.#e.splice(n,0,e),this.#t.splice(n,0,-1),r}moveItemAction(e,n){const r=this.findIndexFrom(e,n),o={op:t.MOVE,originalIndex:this.originalIndexAt(r),from:r,index:n,item:this.#e[r]},[i]=this.#e.splice(r,1);this.#e.splice(n,0,i);const[s]=this.#t.splice(r,1);return this.#t.splice(n,0,s),o}removeRestItems(e){const t=[];for(;this.length>e;)t.push(this.removeItemAction(e));return t}}function o(t,r={},o=[]){return"string"==typeof t?{type:e.ELEMENT,tag:t,props:r,children:i(n(o))}:{type:e.FIBER,tag:t,props:r,children:i(n(o))}}function i(t){return t.map(t=>{return"string"==typeof t?(n=t,{type:e.TEXT,value:n}):t;var n})}function s(e,t,n,r=null){function o(...e){r?t.apply(r,e):t(...e)}return n.addEventListener(e,o),o}function c(t){const{type:n}=t;switch(n){case e.TEXT:!function(e){const{domElement:t}=e;t&&t.remove()}(t);break;case e.ELEMENT:!function(e){const{domElement:t,children:n,listeners:r}=e;if(!t)return;t.remove(),n.forEach(c),r&&(!function(e={},t){Object.entries(e).forEach(([e,n])=>{t.removeEventListener(e,n)})}(r,t),delete e.listeners)}(t);break;case e.FRAGMENT:!function(e){const{children:t}=e;t.forEach(c)}(t);break;case e.FIBER:t.fiberInstance.unmount();break;default:throw new Error("Cannot destroy DOM of type: ",n)}delete t.domElement}function a(e,t){const{class:n,style:r,...o}=t;("string"==typeof n||Array.isArray(n))&&function(e,t){e.className="","string"==typeof t&&(e.className=t);Array.isArray(t)&&e.classList.add(...t)}(e,n),r&&Object.entries(r).forEach(([t,n])=>{"string"==typeof n&&l(e,t,n)});for(const[t,n]of Object.entries(o))"string"==typeof n&&u(e,t,n)}function l(e,t,n){e.style[t]=n}function d(e,t){e.style[t]=null}function u(e,t,n){null==n?h(e,t):t.startsWith("data-")?e.setAttribute(t,String(n)):e[t]=n}function h(e,t){e[t]=null,e.removeAttribute(t)}function f(e){const{on:t,...n}=e.props;return delete n.key,{props:n,eventMap:t}}function m(t,n,r=null,o=null){if(null==n)throw new Error(`\n      "Parent element is not defined: ${n}`);switch(t.type){case e.TEXT:!function(e,t,n){const{value:r}=e,o=document.createTextNode(r);e.domElement=o,E(o,t,n)}(t,n,r);break;case e.ELEMENT:!function(e,t,n,r=null){const{tag:o,children:i}=e,c=document.createElement(o);(function(e,t,n){const{eventMap:r,props:o}=f(t);r&&(t.listeners=function(e={},t,n=null){const r={};return Object.entries(e).forEach(([e,o])=>{const i=s(e,o,t,n);r[e]=i}),r}(r,e,n));a(e,o)})(c,e,r),e.domElement=c,i.forEach(e=>{m(e,c,null,r)}),E(c,t,n)}(t,n,r,o);break;case e.FRAGMENT:!function(e,t,n,r=null){const{children:o}=e;e.domElement=t,o.forEach((e,o)=>{m(e,t,n?n+o:null,r)})}(t,n,r,o);break;case e.FIBER:!function(e,t,n,r=null){const o=e.tag,{eventMap:i,props:s}=f(e),c=new o(s,i,r);c.mount(t,n),e.fiberInstance=c,e.domElement=c.firstDOMElement}(t,n,r,o);break;default:throw new Error("Unknown vNode type")}}function E(e,t,n){if(null==n)return t.appendChild(e);if(n<0)throw new Error(`Position Index must be positive integer, but got ${n}`);const r=t.childNodes;n>=r.length?t.appendChild(e):t.insertBefore(e,r[n])}function p(t){if("children"in t){const n=[];for(const r of t.children)r.type===e.FRAGMENT?n.push(...p(r)):n.push(r);return n}return[]}function y(e,t={}){let n,r=!1,i=null;return{mount(s){if(r)throw new Error("App is already mounted");n=s,i=o(e,t),n&&m(i,n),r=!0},unmount(){if(!r)throw new Error("App is not even mounted");if(!i)throw new Error("There is not even root virtual node");c(i),n=null,r=!1,i=null}}}class v{#r=new Map;#o=[];subscribe(e,t){this.#r.has(e)||this.#r.set(e,[]);const n=this.#r.get(e);return n?.includes(t)?()=>{}:(n?.push(t),function(){if(n){const e=n?.indexOf(t);n?.splice(e,1)}})}afterEveryCommand(e){return this.#o.push(e),()=>{const t=this.#o.indexOf(e);this.#o.splice(t,1)}}dispatch(e,t){this.#r.has(e)?this.#r.get(e)?.forEach(e=>e(t)):console.warn(`No handlers found for command: ${e}`),this.#o.forEach(e=>e())}}function b(e,t){const n=Object.keys(e),r=Object.keys(t);return{added:r.filter(t=>!(t in e)),removed:n.filter(e=>!(e in t)),updated:r.filter(n=>n in e&&e[n]!==t[n])}}function N(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function w(e){return function(e){return""!==e}(e.trim())}function M(t,n){if(t.type===n.type&&t.type===e.ELEMENT&&n.type===e.ELEMENT){const{tag:e,props:{key:r}}=t,{tag:o,props:{key:i}}=n;return e===o&&r===i}if(t.type===n.type&&t.type===e.FIBER&&n.type===e.FIBER){const{tag:e,props:{key:r}}=t,{tag:o,props:{key:i}}=n;return e===o&&r===i}return!1}function I(n,o,i,a=null){if(!M(n,o)){const e=n.domElement?function(e,t){const n=Array.from(e.childNodes).indexOf(t);if(n<0)return null;return n}(i,n.domElement):void 0;return c(n),m(o,i,e,a),o}switch(o.domElement=n.domElement,o.type){case e.TEXT:return n.type===e.TEXT&&function(e,t){if(!e.domElement)throw new Error(`Cannot find DOM Element for old vNode: ${e}`);const n=e.domElement,{value:r}=e,{value:o}=t;r!==o&&(n.nodeValue=o)}(n,o),o;case e.ELEMENT:n.type===e.ELEMENT&&function(e,t,n=null){if(!e.domElement)throw new Error(`Cannot find DOM Element for old vNode: ${e}`);if(!(e.domElement instanceof HTMLElement))throw new Error("patchElement was called with a non-HTMLElement.");const r=e.domElement,{class:o,style:i,on:c,...a}=e.props,{class:f,style:m,on:E,...p}=t.props,{listeners:y}=e;function v(e,t,n){const{added:r,removed:o,updated:i}=b(t,n);for(const t of o)h(e,t);for(const t of r.concat(i))u(e,t,n[t])}function N(e,t,n){const r=l(t),o=l(n),{added:i,removed:s}=(c=r,{added:(a=o).filter(e=>!c.includes(e)),removed:c.filter(e=>!a.includes(e))});var c,a;function l(e=""){return Array.isArray(e)?e.filter(w):e.split(/(\s+)/).filter(w)}s.length>0&&e.classList.remove(...s),i.length>0&&e.classList.add(...i)}function M(e,t={},n={}){const{added:r,removed:o,updated:i}=b(t,n);for(const t of o)d(e,t);for(const t of r.concat(i))l(e,t,n[t])}function I(e,t={},n={},r={},o=null){const{added:i,removed:c,updated:a}=b(n,r);for(const n of c.concat(a))t[n]&&e.removeEventListener(n,t[n]);const l={};for(const t of i.concat(a))r[t]&&(l[t]=s(t,r[t],e,o));return l}v(r,a,p),N(r,o,f),M(r,i,m),t.listeners=I(r,y,c,E,n)}(n,o,a);break;case e.FIBER:n.type===e.FIBER&&function(e,t){const{fiberInstance:n}=e,{props:r}=f(t);n.updateProps(r),t.fiberInstance=n,t.domElement=n.firstDOMElement}(n,o)}return function(e,n,o=null){if(!e.domElement)throw new Error(`Cannot find DOM Element for old vNode: ${e}`);const i=p(e),s=p(n),a=e.domElement,l=function(e,t,n=(e,t)=>e===t){const o=[],i=new r(e,n);for(let e=0;e<t.length;e++){if(i.wasElementRemoved(e,t)){o.push(i.removeItemAction(e)),e--;continue}if(i.wasElementTheSame(e,t)){o.push(i.noopItemAction(e));continue}const n=t[e];i.wasElementAdded(n,e)?o.push(i.addItemAction(n,e)):o.push(i.moveItemAction(n,e))}return o.push(...i.removeRestItems(t.length)),o}(i,s,M);for(const n of l){const{index:r,item:l,op:d}=n,u=o?.offset??0;switch(d){case t.ADD:a instanceof HTMLElement&&m(l,a,r+u,o);break;case t.REMOVE:c(l);break;case t.MOVE:if(a instanceof HTMLElement&&"originalIndex"in n){const t=i[n.originalIndex+u],c=s[r];if(!t.domElement)throw new Error(`Cannot find DOM Element for old vNode: ${e}`);const l=t.domElement,d=a.childNodes[r];a.insertBefore(l,d),I(t,c,a,o)}break;case t.NOOP:a instanceof HTMLElement&&"originalIndex"in n&&I(i[n.originalIndex],s[r],a,o)}}}(n,o,a),o}function g(){}function T({render:t,state:n,onMounted:r=g,onUnmounted:o=g,...i}){class s{#i=!1;#s;#c;#a;#l;#d=new v;#u;props;state;constructor(e={},t={},r=null){this.props=e,this.state=n?n(e):{},this.#a=t,this.#l=r}get domElements(){return null==this.#s?[]:this.#s.type===e.FRAGMENT?p(this.#s).flatMap(t=>t.type===e.FIBER?t.fiberInstance.domElements:t.domElement?[t.domElement]:[]):this.#s.domElement?[this.#s.domElement]:[]}get firstDOMElement(){return this.domElements[0]}get offset(){return this.#c&&this.firstDOMElement&&this.#s?.type===e.FRAGMENT?Array.from(this.#c?.childNodes).indexOf(this.firstDOMElement):0}render(){return t.call(this)}emit(e,t){this.#d.dispatch(e,t)}updateProps(e){this.props={...this.props,...e},this.#h()}updateState(e){this.state={...this.state,...e},this.#h()}onMounted(){return Promise.resolve(r.call(this))}onUnmounted(){return Promise.resolve(o.call(this))}mount(e,t=null){if(this.#i)throw new Error("Fiber is already mounted");this.#s=this.render(),this.#s&&m(this.#s,e,t,this),this.#f(),this.#c=e,this.#i=!0}unmount(){if(!this.#i)throw new Error("Fiber is not mounted");this.#s&&c(this.#s),this.#u.forEach(e=>e()),this.#s=null,this.#c=null,this.#i=!1,this.#u=[]}#h(){if(!this.#i)throw new Error("Fiber is not mounted");const e=this.render();this.#s&&this.#c&&(this.#s=I(this.#s,e,this.#c,this))}#m(e,t){return this.#d.subscribe(e,e=>{this.#l?t.call(this.#l,e):t(e)})}#f(){this.#u=Object.entries(this.#a).map(([e,t])=>this.#m(e,t))}}for(const e in i){if(N(s,e))throw new Error(`Method ${e} already exists in the component.`);s.prototype[e]=i[e]}return s}export{y as createApp,o as createElement,T as createFiber};
//# sourceMappingURL=listenjs.js.map
