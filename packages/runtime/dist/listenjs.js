function e(e,n,t,o=null){function r(...e){o?n.apply(o,e):n(...e)}return t.addEventListener(e,r),r}var n,t;function o(e){const{type:t}=e;switch(t){case n.TEXT:!function(e){const{domElement:n}=e;n&&n.remove()}(e);break;case n.ELEMENT:!function(e){const{domElement:n,children:t,listeners:r}=e;if(!n)return;n.remove(),t.forEach(o),r&&(!function(e={},n){Object.entries(e).forEach(([e,t])=>{n.removeEventListener(e,t)})}(r,n),delete e.listeners)}(e);break;case n.FRAGMENT:!function(e){const{children:n}=e;n.forEach(o)}(e);break;case n.FIBER:e.fiberInstance.unmount();break;default:throw new Error("Cannot destroy DOM of type: ",t)}delete e.domElement}!function(e){e[e.TEXT=Node.TEXT_NODE]="TEXT",e[e.ELEMENT=Node.ELEMENT_NODE]="ELEMENT",e[e.FRAGMENT=Node.DOCUMENT_FRAGMENT_NODE]="FRAGMENT",e.FIBER="FIBER"}(n||(n={})),function(e){e.ADD="add",e.REMOVE="remove",e.MOVE="move",e.NOOP="noop"}(t||(t={}));class r{#e=new Map;#n=[];subscribe(e,n){this.#e.has(e)||this.#e.set(e,[]);const t=this.#e.get(e);return t?.includes(n)?()=>{}:(t?.push(n),function(){if(t){const e=t?.indexOf(n);t?.splice(e,1)}})}afterEveryCommand(e){return this.#n.push(e),()=>{const n=this.#n.indexOf(e);this.#n.splice(n,1)}}dispatch(e,n){this.#e.has(e)?this.#e.get(e)?.forEach(e=>e(n)):console.warn(`No handlers found for command: ${e}`),this.#n.forEach(e=>e())}}function i(e,n){const{class:t,style:o,...r}=n;("string"==typeof t||Array.isArray(t))&&function(e,n){e.className="","string"==typeof n&&(e.className=n);Array.isArray(n)&&e.classList.add(...n)}(e,t),o&&Object.entries(o).forEach(([n,t])=>{"string"==typeof t&&s(e,n,t)});for(const[n,t]of Object.entries(r))"string"==typeof t&&a(e,n,t)}function s(e,n,t){e.style[n]=t}function c(e,n){e.style[n]=null}function a(e,n,t){null==t?l(e,n):n.startsWith("data-")?e.setAttribute(n,String(t)):e[n]=t}function l(e,n){e[n]=null,e.removeAttribute(n)}function d(e){const{on:n,...t}=e.props;return delete t.key,{props:t,eventMap:n}}function u(t,o,r=null,s=null){if(null==o)throw new Error(`\n      "Parent element is not defined: ${o}`);switch(t.type){case n.TEXT:!function(e,n,t){const{value:o}=e,r=document.createTextNode(o);e.domElement=r,f(r,n,t)}(t,o,r);break;case n.ELEMENT:!function(n,t,o,r=null){const{tag:s,children:c}=n,a=document.createElement(s);(function(n,t,o){const{eventMap:r,props:s}=d(t);r&&(t.listeners=function(n={},t,o=null){const r={};return Object.entries(n).forEach(([n,i])=>{const s=e(n,i,t,o);r[n]=s}),r}(r,n,o));i(n,s)})(a,n,r),n.domElement=a,c.forEach(e=>{u(e,a,null,r)}),f(a,t,o)}(t,o,r,s);break;case n.FRAGMENT:!function(e,n,t,o=null){const{children:r}=e;e.domElement=n,r.forEach((e,r)=>{u(e,n,t?t+r:null,o)})}(t,o,r,s);break;case n.FIBER:!function(e,n,t,o=null){const r=e.tag,{eventMap:i,props:s}=d(e),c=new r(s,i,o);c.mount(n,t),e.fiberInstance=c,e.domElement=c.firstDOMElement}(t,o,r,s);break;default:throw new Error("Unknown vNode type")}}function f(e,n,t){if(null==t)return n.appendChild(e);if(t<0)throw new Error(`Position Index must be positive integer, but got ${t}`);const o=n.childNodes;t>=o.length?n.appendChild(e):n.insertBefore(e,o[t])}function E(e){if("children"in e){const t=[];for(const o of e.children)o.type===n.FRAGMENT?t.push(...E(o)):t.push(o);return t}return[]}function m(e){return e.filter(e=>null!=e)}class p{#t=[];#o=[];#r;constructor(e,n){this.#t=[...e],this.#o=e.map((e,n)=>n),this.#r=n}get length(){return this.#t.length}originalIndexAt(e){return this.#o[e]}findIndexFrom(e,n){for(let t=n;t<this.length;t++)if(this.#r(e,this.#t[t]))return t;return-1}wasElementRemoved(e,n){if(e>=this.length)return!1;const t=this.#t[e];return-1===n.findIndex(e=>this.#r(t,e))}wasElementTheSame(e,n){if(e>=this.length)return!1;const t=this.#t[e],o=n[e];return this.#r(t,o)}wasElementAdded(e,n){return-1===this.findIndexFrom(e,n)}removeItemAction(e){const n={op:t.REMOVE,index:e,item:this.#t[e]};return this.#t.splice(e,1),this.#o.splice(e,1),n}noopItemAction(e){return{op:t.NOOP,originalIndex:this.originalIndexAt(e),index:e,item:this.#t[e]}}addItemAction(e,n){const o={op:t.ADD,index:n,item:e};return this.#t.splice(n,0,e),this.#o.splice(n,0,-1),o}moveItemAction(e,n){const o=this.findIndexFrom(e,n),r={op:t.MOVE,originalIndex:this.originalIndexAt(o),from:o,index:n,item:this.#t[o]},[i]=this.#t.splice(o,1);this.#t.splice(n,0,i);const[s]=this.#o.splice(o,1);return this.#o.splice(n,0,s),r}removeRestItems(e){const n=[];for(;this.length>e;)n.push(this.removeItemAction(e));return n}}function h(e,n){const t=Object.keys(e),o=Object.keys(n);return{added:o.filter(n=>!(n in e)),removed:t.filter(e=>!(e in n)),updated:o.filter(t=>t in e&&e[t]!==n[t])}}function y(e){return function(e){return""!==e}(e.trim())}function g(e,t){if(e.type===t.type&&e.type===n.ELEMENT&&t.type===n.ELEMENT){const{tag:n,props:{key:o}}=e,{tag:r,props:{key:i}}=t;return n===r&&o===i}if(e.type===t.type&&e.type===n.FIBER&&t.type===n.FIBER){const{tag:n,props:{key:o}}=e,{tag:r,props:{key:i}}=t;return n===r&&o===i}return!1}function v(r,i,f,m=null){if(!g(r,i)){const e=r.domElement?function(e,n){const t=Array.from(e.childNodes).indexOf(n);if(t<0)return null;return t}(f,r.domElement):void 0;return o(r),u(i,f,e,m),i}switch(i.domElement=r.domElement,i.type){case n.TEXT:return r.type===n.TEXT&&function(e,n){if(!e.domElement)throw new Error(`Cannot find DOM Element for old vNode: ${e}`);const t=e.domElement,{value:o}=e,{value:r}=n;o!==r&&(t.nodeValue=r)}(r,i),i;case n.ELEMENT:r.type===n.ELEMENT&&function(n,t,o=null){if(!n.domElement)throw new Error(`Cannot find DOM Element for old vNode: ${n}`);const r=n.domElement,{class:i,style:d,on:u,...f}=n.props,{class:E,style:m,on:p,...g}=t.props,{listeners:v}=n;function I(e,n,t){const{added:o,removed:r,updated:i}=h(n,t);for(const n of r)l(e,n);for(const n of o.concat(i))a(e,n,t[n])}function T(e,n,t){const o=l(n),r=l(t),{added:i,removed:s}=(c=o,{added:(a=r).filter(e=>!c.includes(e)),removed:c.filter(e=>!a.includes(e))});var c,a;function l(e=""){return Array.isArray(e)?e.filter(y):e.split(/(\s+)/).filter(y)}s.length>0&&e.classList.remove(...s),i.length>0&&e.classList.add(...i)}function N(e,n={},t={}){const{added:o,removed:r,updated:i}=h(n,t);for(const n of r)c(e,n);for(const n of o.concat(i))s(e,n,t[n])}function M(n,t={},o={},r={},i=null){const{added:s,removed:c,updated:a}=h(o,r);for(const e of c.concat(a))t[e]&&n.removeEventListener(e,t[e]);const l={};for(const t of s.concat(a))r[t]&&(l[t]=e(t,r[t],n,i));return l}I(r,f,g),T(r,i,E),N(r,d,m),t.listeners=M(r,v,u,p,o)}(r,i,m);break;case n.FIBER:r.type===n.FIBER&&function(e,n){const{fiberInstance:t}=e,{props:o}=d(n);t.updateProps(o),n.fiberInstance=t,n.domElement=t.firstDOMElement}(r,i)}return function(e,n,r=null){if(!e.domElement)throw new Error(`Cannot find DOM Element for old vNode: ${e}`);const i=E(e),s=E(n),c=e.domElement,a=function(e,n,t=(e,n)=>e===n){const o=[],r=new p(e,t);for(let e=0;e<n.length;e++){if(r.wasElementRemoved(e,n)){o.push(r.removeItemAction(e)),e--;continue}if(r.wasElementTheSame(e,n)){o.push(r.noopItemAction(e));continue}const t=n[e];r.wasElementAdded(t,e)?o.push(r.addItemAction(t,e)):o.push(r.moveItemAction(t,e))}return o.push(...r.removeRestItems(n.length)),o}(i,s,g);for(const n of a){const{index:a,item:l,op:d}=n,f=r?.offset??0;switch(d){case t.ADD:c instanceof HTMLElement&&u(l,c,a+f,r);break;case t.REMOVE:o(l);break;case t.MOVE:if(c instanceof HTMLElement&&"originalIndex"in n){const t=i[n.originalIndex+f],o=s[a];if(!t.domElement)throw new Error(`Cannot find DOM Element for old vNode: ${e}`);const l=t.domElement,d=c.childNodes[a];c.insertBefore(l,d),v(t,o,c,r)}break;case t.NOOP:c instanceof HTMLElement&&"originalIndex"in n&&v(i[n.originalIndex],s[a],c,r)}}}(r,i,m),i}function I({state:e,view:n,reducers:t={}}){let i=null,s=null;const c=new r,a=[c.afterEveryCommand(function(){const t=n(e,l);s&&i&&(s=v(s,t,i))})];function l(e,n){c.dispatch(e,n)}for(const n in t){const o=t[n],r=c.subscribe(n,function(n){e=o(e,n)});a.push(r)}return{mount(t){i=t,s=n(e,l),s&&i&&u(s,i)},unmount(){s&&o(s),s=null,a.forEach(e=>e())}}}function T(e,t={},o=[]){return"string"==typeof e?{type:n.ELEMENT,tag:e,props:t,children:N(m(o))}:{type:n.FIBER,tag:e,props:t,children:N(m(o))}}function N(e){return e.map(e=>{return"string"==typeof e?(t=e,{type:n.TEXT,value:t}):e;var t})}export{I as createApp,T as createElement};
//# sourceMappingURL=listenjs.js.map
